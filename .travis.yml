# standard environment (sudo: required) is provisioned with 7.5g memory, but has 50 minute time limit for jobs
# container-based environment (sudo: false) is provisioned with only 4g memory, but haven't run into time limit for jobs yet
sudo: false
language: java
jdk:
  - oraclejdk8
before_install:
  - "export DISPLAY=:99.0"
  - sh -e /etc/init.d/xvfb start
    # NewRatio is to leave as much memory as possible to old gen
  - echo "MAVEN_OPTS=\"-Xmx768m -XX:NewRatio=20\"" > ~/.mavenrc
install: true
script: build/travis-ci/build.sh $TARGET
cache:
  directories:
  - $HOME/.m2
  - $HOME/.cache/bower
matrix:
  include:
    - jdk: oraclejdk8
      env: TARGET=deploy
    - jdk: oraclejdk8
      env: TARGET=checker
      # chrome
    - jdk: oraclejdk8
      env: TARGET=saucelabs SAUCELABS_PLATFORM="Windows 7" SAUCELABS_BROWSER_NAME=chrome SAUCELABS_BROWSER_VERSION=
env:
  matrix:
    - TARGET=test SKIP_SHADING=false GLOWROOT_HARNESS=javaagent
    - TARGET=test SKIP_SHADING=true GLOWROOT_HARNESS=javaagent
addons:
  firefox: "latest"
  sauce_connect:
    # this is needed on android, see https://support.saucelabs.com/customer/en/portal/questions/13056252
    no_ssl_bump_domains: all
