<!--
  Copyright 2013-2014 the original author or authors.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<div class="panel panel-default">
  <div class="panel-heading">
    <h2>Advanced</h2>
  </div>
  <div class="panel-body">
    <div ng-include src="'template/gt-loading-overlay.html'"></div>
    <div ng-include src="'template/gt-http-error-overlay.html'"></div>
    <div ng-form
         gt-form-with-primary-button
         gt-form-autofocus-on-first-input
         class="form-horizontal"
         name="formCtrl">
      <div gt-form-group
           gt-label="Metric wrapper methods"
           gt-checkbox-label="Wrap woven methods with metric marker methods"
           gt-model="config.metricWrapperMethods"
           gt-type="checkbox">
        <div class="help-block">
          <div class="glowroot-yellow"
               ng-show="originalConfig.metricWrapperMethods !== originalData.metricWrapperMethodsActive"
               style="padding-bottom: 5px;">
            Active value is <code>{{metricWrapperMethodsActive ? 'ON' : 'OFF'}}</code>. The newly configured value
            will take effect on next JVM restart.
          </div>
          <p>
            When enabled, all methods that are woven for trace metric timing are renamed with suffix
            <code>$glowroot$metric$&lt;metric name&gt;</code>
            and a new method is generated in its place that simply calls the renamed method. The purpose of this is so
            that stack traces gathered by the profiler can see what metric timings are active, and the resulting
            profiles can be filtered in the UI by metric names. For example, a profile can be filtered
            to see only the profile of code that is executing jdbc queries. Or, even more useful, filter to see only
            the profile of code that has no metric timings, which helps to discover new bottlenecks that would be
            worth timing via capture points. <em>Changes to this setting will take effect on next JVM restart.</em>
          </p>
        </div>
      </div>
      <div gt-form-group
           gt-label="Immediate partial trace store threshold"
           gt-model="config.immediatePartialStoreThresholdSeconds"
           gt-number="true"
           gt-pattern="pattern.integer"
           gt-required="loaded"
           gt-width="7em"
           gt-addon="seconds">
        <div class="help-block">
          Any transaction that exceeds this amount of time will have its partial trace stored to
          disk immediately (prior to its completion).
          This is to guard against transactions which never complete (or at least run long
          enough and do enough harm to hang the jvm).
        </div>
      </div>
      <div gt-form-group
           gt-label="Max trace entries per transaction"
           gt-model="config.maxTraceEntriesPerTransaction"
           gt-number="true"
           gt-pattern="pattern.integer"
           gt-required="loaded"
           gt-width="7em">
        <div class="help-block">
          Maximum number of trace entries collected for a given transaction. This is used to
          limit the memory requirement of very long transactions that would capture
          potentially hundreds of thousands of trace entries (e.g. large batch or background
          operations).
          Also, the UI is not really optimized for viewing super large numbers of trace entries.
        </div>
      </div>
      <div gt-form-group
           gt-label="Max stack trace samples per transaction"
           gt-model="config.maxStackTraceSamplesPerTransaction"
           gt-number="true"
           gt-pattern="pattern.integer"
           gt-required="loaded"
           gt-width="7em">
        <div class="help-block">
          Maximum number of stack trace samples collected for a given transaction. This is used to
          limit the memory requirement of very long transactions that would capture
          potentially hundreds of thousands of stack traces (e.g. large batch or background
          operations).
        </div>
      </div>
      <div gt-form-group
           gt-label="Thread info"
           gt-checkbox-label="Capture thread info per transaction"
           gt-model="config.captureThreadInfo"
           gt-type="checkbox">
        <div class="help-block">
          Capture thread info per transaction (CPU time, blocked time, waited time and allocated memory) if available.
          See <a href="jvm/capabilities">JVM Capabilities</a>.
        </div>
      </div>
      <div gt-form-group
           gt-label="GC info"
           gt-checkbox-label="Capture garbage collection info per transaction"
           gt-model="config.captureGcInfo"
           gt-type="checkbox">
        <div class="help-block">
          Capture global garbage collection info per transaction.
        </div>
      </div>
      <div gt-form-group
           gt-label="MBean gauge not found delay"
           gt-model="config.mbeanGaugeNotFoundDelaySeconds"
           gt-number="true"
           gt-pattern="pattern.integer"
           gt-required="loaded"
           gt-width="7em"
           gt-addon="seconds">
        <div class="help-block">
          The amount of time to wait during startup before logging any MBean Not Found warning messages.
          This gives the application time during startup to register MBeans.
        </div>
      </div>
      <div gt-form-group
           gt-label="Internal query timeout"
           gt-model="config.internalQueryTimeoutSeconds"
           gt-number="true"
           gt-pattern="pattern.integer"
           gt-required="loaded"
           gt-width="7em"
           gt-addon="seconds">
        <div class="help-block">
          The query timeout applied to all internal queries against the embedded H2 database.
          This is currently useful as some queries may not have been tuned against large data sets,
          and this timeout will prevent them from using too many resources on the host machine, or from blocking
          the limited number of UI threads.
        </div>
      </div>
      <div class="form-group form-buttons">
        <div class="col-lg-offset-3 col-lg-9">
          <div gt-button
               gt-label="Save changes"
               gt-click="save(deferred)"
               gt-disabled="!hasChanges() || formCtrl.$invalid">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
